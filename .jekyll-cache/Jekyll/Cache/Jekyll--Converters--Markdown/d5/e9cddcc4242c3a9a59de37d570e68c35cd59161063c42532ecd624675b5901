I"×0<h1 id="1-ä¸ºä»€ä¹ˆè¦å¯¹é¥æ„Ÿå›¾åƒè¿›è¡Œåˆ‡åˆ†">1. ä¸ºä»€ä¹ˆè¦å¯¹é¥æ„Ÿå›¾åƒè¿›è¡Œåˆ‡åˆ†ï¼Ÿ</h1>
<p>ä¸€èˆ¬çš„é¥æ„Ÿå›¾åƒå°ºå¯¸éƒ½æ˜¯éå¸¸å¤§çš„ï¼Œå°±åƒè¿™é‡Œæˆ‘ä»¬ç”¨çš„ISPRSé¥æ„Ÿå›¾åƒæ•°æ®é›†ï¼Œæ¯å¼ é¥æ„Ÿå›¾åƒ.ttfçš„å°ºå¯¸éƒ½æ˜¯6000 x 6000ï¼Œè¿™æ ¹æœ¬å°±ä¸èƒ½ç”¨äºæˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒğŸ˜£(å†…å­˜ç¬å¹²çˆ†ç‚¸ğŸ’¥)ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬è‡ªå·±å°†å¤§çš„é¥æ„Ÿå›¾åƒåˆ‡åˆ†æˆè‡ªå·±éœ€è¦çš„å°ºå¯¸ï¼Œåƒæ˜¯å¸¸ç”¨çš„224 x 224ï¼Œ512 x 512ç­‰ã€‚</p>

<p><img src="https://img-blog.csdnimg.cn/20201221231843185.png#pic_center" width="50%" /></p>

<p>å¤§å®¶å¯ä»¥åˆ©ç”¨å¦‚ä¸‹ä»£ç å°†é¥æ„Ÿå›¾åƒåˆ‡åˆ†æˆ224 x 224çš„å¤§å°ï¼Œå¦‚éœ€æ”¹æˆå…¶ä»–å°ºå¯¸å¯ä»¥ç¨ä½œä¿®æ”¹ã€‚</p>

<h1 id="2-åˆ‡åˆ†å›¾åƒåˆ¶ä½œæ•°æ®é›†">2. åˆ‡åˆ†å›¾åƒï¼Œåˆ¶ä½œæ•°æ®é›†</h1>

<p>Labelså›¾åƒçš„å¤§å°å’Œé¥æ„Ÿå›¾åƒçš„å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ‡åˆ†å›¾åƒçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ä¸€å—æŠŠLabelså›¾åƒåˆ‡åˆ†äº†ï¼Œä»¥ä¾¿RGBå›¾åƒå’ŒLabelså›¾åƒå¯¹åº”ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">gen_datasets.py</code></p>

<p>å› ä¸ºæˆ‘çš„ç”µè„‘æ‰¿å—ä¸äº†å¤ªå¤§çš„æ•°æ®é›†ğŸ˜…ï¼Œæ‰€ä»¥åœ¨åˆ¶ä½œæ•°æ®é›†çš„æ—¶å€™æˆ‘åªåˆ‡åˆ†äº†ä¸€å¼ é¥æ„Ÿå›¾åƒã€‚</p>

<style>
    .warpper7i{
        background:#121212;
        border-radius:5px;
        width:100%;
    }
    .mac {
        width:10px;
        height:10px;
        border-radius:5px;
        float:left;
        margin:10px 0 0 5px;
    }
    .b1 {
        background:#E0443E;
        margin-left: 10px;
    }
    .b2 { background:#DEA123; }
    .b3 { background:#1AAB29; }
</style>

<div class="warpper7i">
    <div class="mac b1"></div>
    <div class="mac b2"></div>
    <div class="mac b3"></div>
    <br />
</div>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="n">import</span> <span class="n">cv2</span>
<span class="n">import</span> <span class="n">numpy</span>


<span class="n">img1</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="err">'</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">fuhao7i</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="err">åŒ—æ¼ </span><span class="o">/</span><span class="n">ISPRS</span><span class="err">é¥æ„Ÿå›¾åƒåˆ†å‰²</span><span class="o">/</span><span class="mi">2</span><span class="n">_Ortho_RGB</span><span class="o">/</span><span class="n">top_potsdam_2_10_RGB</span><span class="p">.</span><span class="n">tif</span><span class="err">'</span><span class="p">)</span> <span class="err">#è¯»å–</span><span class="n">RGB</span><span class="err">åŸå›¾åƒ</span>

<span class="n">img2</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="err">'</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">fuhao7i</span><span class="o">/</span><span class="n">Desktop</span><span class="o">/</span><span class="err">åŒ—æ¼ </span><span class="o">/</span><span class="n">ISPRS</span><span class="err">é¥æ„Ÿå›¾åƒåˆ†å‰²</span><span class="o">/</span><span class="mi">5</span><span class="n">_Labels_all</span><span class="o">/</span><span class="n">top_potsdam_2_10_label</span><span class="p">.</span><span class="n">tif</span><span class="err">'</span><span class="p">)</span> <span class="err">#è¯»å–</span><span class="n">Labels</span><span class="err">å›¾åƒ</span>

<span class="cp">#å› ä¸º6000/224 = 26ï¼Œæ‰€ä»¥6000x6000çš„å›¾åƒå¯ä»¥åˆ’åˆ†ä¸º26x26ä¸ª224x224å¤§å°çš„å›¾åƒ
</span><span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="o">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="o">:</span>
        <span class="n">img1_</span> <span class="o">=</span> <span class="n">img1</span><span class="p">[</span><span class="mi">224</span><span class="o">*</span><span class="n">i</span> <span class="o">:</span> <span class="mi">224</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">224</span><span class="o">*</span><span class="n">j</span> <span class="o">:</span> <span class="mi">224</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="o">:</span> <span class="p">]</span>
        <span class="n">img2_</span> <span class="o">=</span> <span class="n">img2</span><span class="p">[</span><span class="mi">224</span><span class="o">*</span><span class="n">i</span> <span class="o">:</span> <span class="mi">224</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">224</span><span class="o">*</span><span class="n">j</span> <span class="o">:</span> <span class="mi">224</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="o">:</span> <span class="p">]</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mi">26</span> <span class="o">+</span> <span class="n">j</span>
        <span class="cp">#è®©RGBå›¾åƒå’Œæ ‡ç­¾å›¾åƒçš„æ–‡ä»¶åå¯¹åº”
</span>        <span class="n">name</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cv2</span><span class="p">.</span><span class="n">imwrite</span><span class="p">(</span><span class="err">'</span><span class="p">.</span><span class="o">/</span><span class="n">jpg</span><span class="o">/</span><span class="err">'</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="err">'</span><span class="p">.</span><span class="n">jpg</span><span class="err">'</span><span class="p">,</span> <span class="n">img1_</span><span class="p">)</span> <span class="err">#æ‰€æœ‰çš„</span><span class="n">RGB</span><span class="err">å›¾åƒéƒ½æ”¾åˆ°</span><span class="n">jpg</span><span class="err">æ–‡ä»¶å¤¹ä¸‹</span>
        <span class="n">cv2</span><span class="p">.</span><span class="n">imwrite</span><span class="p">(</span><span class="err">'</span><span class="p">.</span><span class="o">/</span><span class="n">png</span><span class="o">/</span><span class="err">'</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="err">'</span><span class="p">.</span><span class="n">png</span><span class="err">'</span><span class="p">,</span> <span class="n">img2_</span><span class="p">)</span> <span class="err">#æ‰€æœ‰çš„æ ‡ç­¾å›¾åƒéƒ½æ”¾åˆ°</span><span class="n">png</span><span class="err">æ–‡ä»¶å¤¹ä¸‹</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">e.g.</code></p>

<p><img src="https://img-blog.csdnimg.cn/20201221232942188.png#pic_center" width="90%" /></p>

<p><code class="language-plaintext highlighter-rouge">gen_testdata.py</code></p>

<p>åŒç†å¯ä»¥å¾—åˆ°æµ‹è¯•é›†å›¾åƒã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">testdata_path</span> <span class="o">=</span> <span class="s">'/Users/fuhao7i/Desktop/åŒ—æ¼ /ISPRSé¥æ„Ÿå›¾åƒåˆ†å‰²/2_Ortho_RGB/top_potsdam_2_13_RGB.tif'</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">testdata_path</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">26</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">26</span><span class="p">):</span>
        <span class="n">img_</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="mi">224</span><span class="o">*</span><span class="n">i</span> <span class="p">:</span> <span class="mi">224</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">224</span><span class="o">*</span><span class="n">j</span> <span class="p">:</span> <span class="mi">224</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">:</span> <span class="p">]</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="mi">26</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">cv2</span><span class="p">.</span><span class="n">imwrite</span><span class="p">(</span><span class="s">'./test/'</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">'.jpg'</span><span class="p">,</span> <span class="n">img_</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">get_train_txt.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">'./jpg'</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./train.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">'.jpg;'</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">'.png</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">e.g.</code></p>

<p><img src="https://img-blog.csdnimg.cn/20201221232824570.png#pic_center" width="90%" /></p>

<p>ç°åœ¨æˆ‘ä»¬çš„é¥æ„Ÿå›¾åƒæ•°æ®é›†å°±å‡†å¤‡å¥½äº†ğŸ‰ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å¼€å§‹å°èŠçš„è¯­ä¹‰åˆ†å‰²å§ï½ï½ï½</p>
:ET