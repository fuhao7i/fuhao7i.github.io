I"¦
<!-- ---
layout:     post
title:      "Neural NetworkğŸ¦–8â€”â€”'model.eval()' VS 'with torch.no_grad()'"
subtitle:   " \"BatchNorm, Dropout, grad_backprop\""
date:       2021-04-13 10:12:00
author:     "fuhao7i"
header-img: "img/in-post/nn.jpg"
catalog: true
tags:
    - Neural NetworkğŸ¦–
--- -->
<hr />
<p>layout:     post
title:      â€œNeural NetworkğŸ¦–7â€”â€”How to clip gradient?â€
subtitle:   â€œ "clip grad, Gradient clipping, Gradient Scaling"â€
date:       2021-04-07 11:12:00
author:     â€œfuhao7iâ€
header-img: â€œimg/in-post/nn.jpgâ€
catalog: true
tags:
    - Neural NetworkğŸ¦–
â€”</p>

<p>In short</p>
<ul>
  <li>model.eval() will notify all your layers that you are in eval mode, that way, batchnorm or dropout layers will work in eval mode instead of training mode.</li>
  <li>torch.no_grad() impacts the autograd engine and deactivate it. It will reduce memory usage and speed up computations but you wonâ€™t be able to backprop(which you donâ€™t want in an eval script).</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_loader</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="nb">eval</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">data_loader</span> <span class="o">=</span> <span class="n">data_loader</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data_batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">data_loader</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">model</span><span class="p">(</span><span class="n">data_batch</span><span class="p">)</span>
            <span class="p">...</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="reference">reference</h1>

<ul>
  <li><a href="https://discuss.pytorch.org/t/model-eval-vs-with-torch-no-grad/19615">â€˜model.eval()â€™ vs â€˜with torch.no_grad()â€™</a></li>
</ul>
:ET